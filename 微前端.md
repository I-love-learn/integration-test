# 微前端

微前端的灵感来源自后端的微服务，在一个单页面应用中请求的接口，背后的后端应用则是数量庞大的微服务集群。

微前端是一种多个团队通过独立发布功能的方式来共同构建现代化 web 应用的技术手段及方法策略。

微前端的核心目标是将巨石应用拆解成若干可以自治的松耦合微应用，这样才能确保微应用真正具备独立开发、独立运行的能力。

- **技术栈无关主框架不限制接入应用的技术栈，微应用具备完全自主权；**
- **独立开发、独立部署微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新；**
- **增量升级在面对各种复杂场景时，我们通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略；**
- **独立运行时每个微应用之间状态隔离，运行时状态不共享。**

## 微服务

每个 springboot 项目都可以看作是一个微服务中的一个服务模块 多个 springboot 项目可以受 springcloud 管理

SpringBoot 和 SpringCloud 是两个独立的项目，但是 SpringCloud 构建在 SpringBoot 之上，并且依赖于 SpringBoot 中的很多核心功能。如果要使用 SpringCloud 来构建分布式应用程序，就必须要使用 SpringBoot 来作为基础框架。因此，可以说 SpringCloud 是针对微服务架构的补充和加强，与 SpringBoot 可以协同使用来构建高可用性、可伸缩性和易维护性的分布式系统。

https://xie.infoq.cn/article/5c859dda520e4b3bf47b62ea7

## 微前端框架

### qiankun

qiankun 方案是基于 single-spa 的微前端方案。

> single-spa 官网：https://single-spa.js.org/docs/getting-started-overview
>
> 什么是 single-spa：https://blog.csdn.net/qq_35876316/article/details/143475963
>
> single-spa 源码解析：https://www.cnblogs.com/kongshu-612/p/18336868
>
> single-spa 是如何运行的？：https://juejin.cn/post/7123861138164432926
>
> 一张图简述 single-spa 原理：https://juejin.cn/post/7369436144197648418?searchId=202412022113552D2FF4F19806AD12BC92
>
> 深入微前端（一）：single-spa 入门、实战、手写实现与分析：https://juejin.cn/post/7418876519815413794?searchId=202412022113552D2FF4F19806AD12BC92#heading-6
>
> 微前端框架 之 single-spa 从入门到精通：https://zhuanlan.zhihu.com/p/463654743

single-spa 缺点是没有 js 隔离与 css 隔离需要手动处理而 qiankun 基于这个进行了封装,简化了微应用的注册方式，增加了微应用的沙箱管理(js、css 隔离)与全局状态共享机制，并且 qiankun 内部实现了一个解析 html 字符串获取静态资源地址的解析库 import-html-entry，方便微应用接入与资源预加载。

###### popstate,pushState 和 replaceState 这几种方法或事件的作用?

https://zhuanlan.zhihu.com/p/665529595

single-spa 的核心就是通过拦截与监听浏览器的路由事件 然后对子应用进行挂载与卸载的。

它要求所有的应用自己抽象成那四个方法。而且所有的应用都在同一个 js 的上下文中执行，所有很容易会出现互相打架的情况。qiankun 提供的 js 沙盒，就是为了这个准备的。对应用之间做了隔离。

##### single-spa 的缺陷

> 对子应用的侵入性太强

single-spa 采用 `JS Entry` 的方式接入子应用，这就要求整个子应用要打包成一个 JS 文件，常见的打包优化基本上都没了，比如：按需加载、首屏资源加载优化、css 独立打包等优化措施。

> 样式隔离问题和 JS 隔离

全局样式和全局对象（window）的污染

> 资源预加载 和 应用间通信

子应用已经被整个打包成 js 文件，所以做不到让浏览器在后台悄悄的加载其它子应用的静态资源

正是因为有以上这些问题，所以实际开发中我们一般不会直接使用 `single-spa`，而是采用更成熟完善的微前端解决方案：`qiankun`（乾坤）；在下一篇，我们会详细展开对 `qiankun` 的介绍和源码分析，以及在实际应用中可能遇到的挑战和解决方案。

> 也就是说 single-spa 最终打包完毕的子应用是 js 文件，并且需要去手动为每个子应用去处理增加对应的生命周期函数，用起来比较麻烦，还会污染 window 对象，没有 css 的隔离
